
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TheItalianPoetry - La Tua Dashboard Artistica</title>
  
  <script src="app.js" defer></script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&family=Open+Sans:wght@400;600&family=Poppins:wght@600&family=Roboto:wght@400;500&display=swap" rel="stylesheet">

  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

  
  <!-- Styles (lasciati con i path originali) -->
  <link rel="stylesheet" href="poetry-widget.css">
  <link rel="stylesheet" href="css/01-base.css">
  <link rel="stylesheet" href="css/02-header-nav.css">
  <link rel="stylesheet" href="css/03-hero.css">
  <link rel="stylesheet" href="css/04-layout-buttons.css">
  <link rel="stylesheet" href="css/05-components.css">
  <link rel="stylesheet" href="css/06-responsive-print.css">

  <!-- Ads -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4946352643458279" crossorigin="anonymous"></script>

  <!-- React (per widget) -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Inizio modifica: Stili aggiuntivi -->
  <style>
    .hidden { display: none !important; }
    .hidden-content { display: none; }
    .hidden-content.is-visible { display: block; animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-4px); } to { opacity: 1; transform: translateY(0); } }
    body.modal-open { overflow: hidden; }
    .info-modal { position: fixed; inset: 0; background: rgba(16, 24, 40, 0.55); backdrop-filter: blur(2px); display: flex; align-items: center; justify-content: center; padding: 1.5rem; z-index: 999; }
    .info-modal .modal-content { background: #fff; max-width: 640px; width: 100%; border-radius: 1rem; padding: 2rem; position: relative; box-shadow: 0 20px 40px rgba(15, 23, 42, 0.25); overflow-y: auto; max-height: 90vh; }
    .info-modal .modal-content h2 { font-family: 'Montserrat', sans-serif; margin-bottom: 1rem; font-weight: 700; }
    .info-modal .modal-content p, .info-modal .modal-content li { font-family: 'Open Sans', sans-serif; line-height: 1.6; }
    .info-modal .modal-content ol, .info-modal .modal-content ul { margin-left: 1.5rem; margin-bottom: 1.25rem; }
    .info-modal [data-close-modal] { position: absolute; top: 1rem; right: 1rem; font-size: 1.5rem; background: transparent; border: none; cursor: pointer; color: #1f2937; }
    .scroll-top-btn { position: fixed; bottom: 1.5rem; right: 1.5rem; width: 3rem; height: 3rem; border-radius: 50%; border: none; background: linear-gradient(135deg, #f97316, #facc15); color: #111827; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 10px 25px rgba(249, 115, 22, 0.35); opacity: 0; visibility: hidden; transform: translateY(20px); transition: all 0.3s ease; z-index: 998; }
    .scroll-top-btn.is-visible { opacity: 1; visibility: visible; transform: translateY(0); }
    .discover-more.active .arrow-down { transform: rotate(180deg); }
    .discover-more .arrow-down { transition: transform 0.3s ease; }
    #share-fallback.active { display: block; }
    #share-fallback { display: none; }
    .copy-feedback { display: block; margin-top: 0.5rem; font-size: 0.875rem; color: #047857; min-height: 1.2em; }
    @media (max-width: 640px) {
      .info-modal .modal-content { padding: 1.5rem; border-radius: 0.75rem; }
      .scroll-top-btn { right: 1rem; bottom: 1rem; }
    }
  </style>
</head>
<body>

  <header class="main-header">
    <!-- Logo centrale -->
    <div class="logo">
      <i class="fa-solid fa-feather-pointed"></i>
      <span>TheItalianPoetry</span>
    </div>

    <!-- Hamburger per mobile -->
    <button class="mobile-nav-toggle" aria-controls="primary-navigation" aria-expanded="false" aria-label="Menu">
      <i class="fas fa-bars" aria-hidden="true"></i>
      <span class="sr-only">Menu</span>
    </button>

    <!-- Navigazione e azioni -->
    <div class="nav-wrapper" id="primary-navigation" data-visible="false">
      <nav class="main-nav">
       <a href="#leaderboard">Classifica</a>
        <a href="#" id="how-to-link">Come Partecipare</a>
        <a href="#" id="about-us-link">Chi Siamo</a>
        <a href="italian_poetry_portfolio/pages/poet_portfolio_landing.html" id="diario-link">Diario</a>
        <a href="author-page.html" id="author-link">Autore</a>
      </nav>
      <div class="header-actions">
        <div id="auth-buttons">
          <button id="login-google-btn" class="button-social google">
            <i class="fab fa-google"></i> Accedi con Google
          </button>
        </div>
        <div id="user-info" class="hidden">
          <span id="user-email"></span>
          <button id="logout-btn" class="button-secondary">Logout</button>
        </div>
        <button id="open-submission-modal-btn" class="button-primary" disabled>Partecipa</button>
      </div>
    </div>
  </header>

  <main>
    <!-- Hero attaccata all’header -->
    <section class="hero-section">
      <div class="hero-content">
        <h1>Le Voci Più Amate del Mese!</h1>
        <p>Scopri i talenti emergenti della nostra community votati da te e pubblicati su Instagram! Sostieni i tuoi artisti preferiti e lasciati ispirare.</p>
      </div>
    </section>

   <!-- ▼▼▼ COUNTDOWN ▼▼▼ -->
    <section class="countdown-section">
      <div class="countdown-container">
        <h2 class="countdown-title">⏰ Tempo rimanente questo mese</h2>
        <div class="countdown-display">
          <div class="countdown-item">
            <span class="countdown-number" id="countdown-days">00</span>
            <span class="countdown-label">GIORNI</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-number" id="countdown-hours">00</span>
            <span class="countdown-label">ORE</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-number" id="countdown-minutes">00</span>
            <span class="countdown-label">MIN</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-number" id="countdown-seconds">00</span>
            <span class="countdown-label">SEC</span>
          </div>
        </div>
        <p class="countdown-subtitle">Partecipa prima che finisca il mese!</p>
      </div>
    </section>
    <!-- ▲▲▲ COUNTDOWN ▲▲▲ -->
    
    <div class="container">
      <div class="content-area">
        <section id="mission-principale" class="card-section">
          <div class="card-content">
            <h2>
              <span class="red-text">Scrivi</span>,
              <span class="gold-text">Brilla</span>,
              <span class="green-text">Cresci</span>: La Nostra Community per la Scrittura Creativa
            </h2>
            <p>Benvenuto nella community dove le tue parole prendono vita e la tua creatività viene premiata! Qui crediamo che il vero valore della scrittura risieda nella sua bellezza, originalità e capacità di emozionare.</p>
            <div class="discover-more" id="discover-more-trigger">
              <span>Scopri di più</span>
              <div class="arrow-down"></div>
            </div>
          </div>
        </section>

        <section id="expanded-content" class="card-section hidden-content">
          <div class="card-content" id="card-mission-dettagliata">
            <div class="mission-paragraphs">
              <div class="mission-block">
                <h3 class="red-title">Come Funziona?</h3>
                <p>La giuria popolare sei tu! Condividi poesie, ricevi voti e scala la classifica. I 10 più votati del mese verranno pubblicati su Instagram.</p>
              </div>
              <div class="mission-block">
                <h3 class="yellow-title">Un Ecosistema Sostenibile</h3>
                <p>Manteniamo la piattaforma gratuita grazie ad annunci non invasivi, nel rispetto della tua esperienza e privacy.</p>
              </div>
              <div class="mission-block">
                <h3 class="green-title">Disclaimer</h3>
                <p>Gli annunci supportano i costi senza compromettere la leggibilità: niente pop-up fastidiosi, solo poesia.</p>
              </div>
            </div>
          </div>
        </section>

        <h2 class="section-title" id="leaderboard">Classifica Principale</h2>
        <div class="poems-list"><!-- Popolato dinamicamente --></div>
      </div>

      <aside class="sidebar">
        <div class="sidebar-box">
          <h3>Sponsorizzato da</h3>
          <ins class="adsbygoogle" style="display:block"
               data-ad-client="ca-pub-4946352643458279"
               data-ad-slot="5215106498"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div class="sidebar-box">
          <h3>Poesie del Mese</h3>
          <div class="search-box">
            <input type="text" id="search-poems" placeholder="Cerca titolo o autore..." aria-label="Cerca poesie">
            <i class="fas fa-search search-icon"></i>
          </div>
          <div class="filter-options">
            <label for="sort-by">Ordina per:</label>
            <select id="sort-by">
              <option value="recent">Più Recenti</option>
              <option value="popular">Più Votate</option>
              <option value="title-asc">Titolo (A-Z)</option>
              <option value="title-desc">Titolo (Z-A)</option>
            </select>
          </div>
          <div id="monthly-poems-list" class="mini-poems-list"></div>
          <a href="#leaderboard" class="button-secondary full-width-btn">Vedi Classifica Principale</a>
        </div>

        <div class="sidebar-box">
          <h3>Sponsorizzato da</h3>
          <ins class="adsbygoogle" style="display:block"
               data-ad-client="ca-pub-4946352643458279"
               data-ad-slot="5215106498"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <div class="sidebar-box">
          <h3><i class="fas fa-pen-fancy"></i> Vuoi Partecipare?</h3>
          <p>Condividi la tua arte con la community e fatti votare!</p>
          <div class="participate-buttons">
            <button id="sidebar-participate-btn" class="participation-btn"><i class="fas fa-info-circle"></i> Scopri Come</button>
            <button id="share-cta-btn" class="participation-btn"><i class="fab fa-instagram"></i> Condividi</button>
          </div>
          <div id="share-fallback" class="hidden">
            <div class="share-link-box">
              <input type="text" id="poem-share-link" readonly value="https://theitalianpoetry.it/partecipa">
              <button id="copy-link-btn" class="button-copy"><i class="fas fa-copy"></i> Copia</button>
            </div>
            <p class="share-hint">Condividi questo link sui social!</p>
            <!-- Inizio modifica: Feedback copia link -->
            <span id="copy-feedback" class="copy-feedback" aria-live="polite"></span>
          </div>
        </div>
      </aside>
    </div>

    <section class="poetry-widget-section">
      <h2 class="widget-title">Analisi IA</h2>
      <div id="poetry-widget-container"></div>
    </section>

    <!-- Inizio modifica: Modali informative -->
    <div id="how-to-modal" class="info-modal hidden" role="dialog" aria-modal="true" aria-labelledby="how-to-modal-title" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close-btn" data-close-modal aria-label="Chiudi">&times;</button>
        <h2 id="how-to-modal-title">Come partecipare</h2>
        <p>Partecipa alla classifica mensile seguendo questi semplici passaggi:</p>
        <ol>
          <li><strong>Accedi</strong> con il tuo account Google per sbloccare l’area invii.</li>
          <li><strong>Invia la tua poesia</strong> rispettando il tema del mese e il limite di 300 parole.</li>
          <li><strong>Condividi il link</strong> con amici e follower per raccogliere voti in tempo reale.</li>
          <li><strong>Scala la classifica</strong>: i primi 10 verranno pubblicati sul nostro profilo Instagram ufficiale.</li>
        </ol>
        <p>Hai dubbi? Scrivici a <a href="mailto:hello@theitalianpoetry.it">hello@theitalianpoetry.it</a>.</p>
      </div>
    </div>

    <div id="about-modal" class="info-modal hidden" role="dialog" aria-modal="true" aria-labelledby="about-modal-title" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close-btn" data-close-modal aria-label="Chiudi">&times;</button>
        <h2 id="about-modal-title">Chi siamo</h2>
        <p>TheItalianPoetry è una casa digitale per autori e lettori che amano la parola scritta. Crediamo in una community meritocratica e inclusiva, in cui il talento venga scoperto e sostenuto attraverso un sistema di votazioni trasparente.</p>
        <ul>
          <li><strong>Community first:</strong> ogni decisione nasce dai feedback della nostra base utenti.</li>
          <li><strong>Trasparenza:</strong> voti pubblici e monitoraggio costante contro attività sospette.</li>
          <li><strong>Formazione continua:</strong> workshop, guide e mentorship dedicate agli autori emergenti.</li>
        </ul>
        <p>Seguici su <a href="https://www.instagram.com/theitalianpoetry/" target="_blank" rel="noreferrer noopener">Instagram</a> per rimanere aggiornato su contest e novità.</p>
      </div>
    </div>

    <div id="author-modal" class="info-modal hidden" role="dialog" aria-modal="true" aria-labelledby="author-modal-title" aria-hidden="true">
      <div class="modal-content">
        <button type="button" class="modal-close-btn" data-close-modal aria-label="Chiudi">&times;</button>
        <h2 id="author-title">Autore</h2>
      <p>Seguici su Instagram per le pubblicazioni mensili.</p>
      <a href="author-page.html"="_blank" class="button-secondary" style="display:inline-block;margin-top:.5rem;">Vai al profilo</a>      </div>
    </div>
  </main>


<div id="poetry-widget-overlay" class="poetry-widget-fixed hidden">
  <iframe
    src="https://widget.theitalianpoetryproject.com/"
    allow="autoplay"
  ></iframe>
</div>
 



  <footer class="main-footer">
    <div class="footer-content">
      <p>© 2025 TheItalianPoetry. Tutti i diritti riservati.</p>
      <div class="footer-links">
        <a href="#">Privacy Policy</a>
        <a href="#">Termini di Servizio</a>
        <a href="#">Disclaimer</a>
      </div>
      <div class="footer-social">
        <a href="https://www.instagram.com/theitalianpoetry/" target="_blank"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-facebook"></i></a>
        <a href="#"><i class="fab fa-twitter"></i></a>
      </div>
    </div>
  </footer>

  <!-- Inizio modifica: Pulsante torna su -->
  <button id="scroll-top-btn" class="scroll-top-btn" type="button" aria-label="Torna all'inizio">
    <i class="fas fa-arrow-up" aria-hidden="true"></i>
  </button>

  <!-- ========== MODALE VOTAZIONE A STELLE (coerente con app.js) ========== -->
  <div id="voting-modal" class="modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="vote-modal-title">
    <div class="modal-content">
      <button id="close-voting-modal-btn" class="modal-close-btn" aria-label="Chiudi">&times;</button>

      <h2 id="vote-modal-title" style="margin-bottom:.5rem;">Vota la poesia</h2>
      <p id="vote-poem-title" style="font-weight:700;"></p>
      <p id="vote-poem-author" style="color:#6B7280; margin-bottom:1rem;"></p>

      <div class="star-rating" role="radiogroup" aria-label="Valuta con le stelle">
        <input type="radio" id="star1" name="rating" value="1" class="sr-only">
        <label for="star1" class="star" aria-label="1 stella"><i class="fa-regular fa-star"></i></label>

        <input type="radio" id="star2" name="rating" value="2" class="sr-only">
        <label for="star2" class="star" aria-label="2 stelle"><i class="fa-regular fa-star"></i></label>

        <input type="radio" id="star3" name="rating" value="3" class="sr-only">
        <label for="star3" class="star" aria-label="3 stelle"><i class="fa-regular fa-star"></i></label>

        <input type="radio" id="star4" name="rating" value="4" class="sr-only">
        <label for="star4" class="star" aria-label="4 stelle"><i class="fa-regular fa-star"></i></label>

        <input type="radio" id="star5" name="rating" value="5" class="sr-only">
        <label for="star5" class="star" aria-label="5 stelle"><i class="fa-regular fa-star"></i></label>
      </div>

      <input type="hidden" id="vote-poem-id" />
      <button id="submit-vote-btn" class="button-primary" style="margin-top:.5rem;">Invia Voto</button>
      <p id="vote-form-message" role="status" aria-live="polite" style="margin-top:.75rem;"></p>
    </div>
  </div>
  <!-- =============================================================== -->

  <!-- Supabase + App (solo JS/DB: lasciati corretti e in ordine) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="module" src="app.js"></script>

  <!-- Inizio modifica: Script funzionalità aggiuntive -->
  <script type="module">
    const initEnhancements = () => {
      const body = document.body;
      const navToggle = document.querySelector('.mobile-nav-toggle');
      const navWrapper = document.getElementById('primary-navigation');

      if (navToggle && navWrapper) {
        navToggle.addEventListener('click', () => {
          const isVisible = navWrapper.getAttribute('data-visible') === 'true';
          const nextState = !isVisible;
          navWrapper.setAttribute('data-visible', String(nextState));
          navToggle.setAttribute('aria-expanded', String(nextState));
        });

        navWrapper.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            navWrapper.setAttribute('data-visible', 'false');
            navToggle.setAttribute('aria-expanded', 'false');
          });
        });
      }

      const discoverMoreTrigger = document.getElementById('discover-more-trigger');
      const expandedContent = document.getElementById('expanded-content');
      if (discoverMoreTrigger && expandedContent) {
        expandedContent.setAttribute('aria-hidden', 'true');
        discoverMoreTrigger.setAttribute('role', 'button');
        discoverMoreTrigger.setAttribute('tabindex', '0');
        discoverMoreTrigger.setAttribute('aria-expanded', 'false');
        const toggleExpanded = () => {
          const isVisible = expandedContent.classList.toggle('is-visible');
          expandedContent.setAttribute('aria-hidden', String(!isVisible));
          discoverMoreTrigger.setAttribute('aria-expanded', String(isVisible));
          discoverMoreTrigger.classList.toggle('active', isVisible);
          const labelSpan = discoverMoreTrigger.querySelector('span');
          if (labelSpan) labelSpan.textContent = isVisible ? 'Mostra meno' : 'Scopri di più';
        };
        discoverMoreTrigger.addEventListener('click', toggleExpanded);
        discoverMoreTrigger.addEventListener('keypress', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            toggleExpanded();
          }
        });
      }

      const modals = {
        howTo: document.getElementById('how-to-modal'),
        about: document.getElementById('about-modal'),
        author: document.getElementById('author-modal')
      };

      const setBodyScrollLock = () => {
        const anyOpen = [...document.querySelectorAll('.info-modal')].some(modal => !modal.classList.contains('hidden'));
        if (anyOpen) {
          body.classList.add('modal-open');
        } else {
          body.classList.remove('modal-open');
        }
      };

      const focusableSelector = 'button, [href], input, textarea, select, [tabindex]:not([tabindex="-1"])';
      const openModal = (modal) => {
        if (!modal) return;
        modal.classList.remove('hidden');
        modal.setAttribute('aria-hidden', 'false');
        setBodyScrollLock();
        const focusable = modal.querySelector(focusableSelector);
        focusable?.focus();
      };

      const closeModal = (modal) => {
        if (!modal) return;
        modal.classList.add('hidden');
        modal.setAttribute('aria-hidden', 'true');
        setBodyScrollLock();
      };

      const modalTriggers = [
        { element: document.getElementById('how-to-link'), target: modals.howTo },
        { element: document.getElementById('sidebar-participate-btn'), target: modals.howTo },
        { element: document.getElementById('about-us-link'), target: modals.about },
        { element: document.getElementById('author-link'), target: modals.author }
      ];

      modalTriggers.forEach(({ element, target }) => {
        if (element && target) {
          element.addEventListener('click', (event) => {
            event.preventDefault();
            openModal(target);
          });
        }
      });

      Object.values(modals).forEach(modal => {
        if (!modal) return;
        modal.addEventListener('click', (event) => {
          if (event.target === modal) {
            closeModal(modal);
          }
        });
      });

      document.querySelectorAll('[data-close-modal]').forEach(button => {
        button.addEventListener('click', () => {
          const modal = button.closest('.info-modal');
          closeModal(modal);
        });
      });

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
          Object.values(modals).forEach(modal => !modal?.classList.contains('hidden') && closeModal(modal));
        }
      });

      const shareBtn = document.getElementById('share-cta-btn');
      const shareFallback = document.getElementById('share-fallback');
      const shareLinkInput = document.getElementById('poem-share-link');
      const copyLinkBtn = document.getElementById('copy-link-btn');
      const copyFeedback = document.getElementById('copy-feedback');
      let copyTimeoutId;

      if (shareBtn) {
        shareBtn.addEventListener('click', async () => {
          const shareData = {
            title: 'Condividi la tua poesia!',
            text: 'Partecipa alla community di TheItalianPoetry e fai votare il tuo talento.',
            url: shareLinkInput?.value ?? window.location.href
          };
          if (navigator.share) {
            try {
              await navigator.share(shareData);
            } catch (error) {
              if (error.name !== 'AbortError') {
                shareFallback?.classList.remove('hidden');
                shareFallback?.classList.add('active');
              }
            }
          } else {
            shareFallback?.classList.remove('hidden');
            shareFallback?.classList.add('active');
          }
        });
      }

      if (copyLinkBtn && shareLinkInput) {
        copyLinkBtn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(shareLinkInput.value);
            if (copyFeedback) {
              copyFeedback.textContent = 'Copiato negli appunti!';
              clearTimeout(copyTimeoutId);
              copyTimeoutId = setTimeout(() => { copyFeedback.textContent = ''; }, 2500);
            }
          } catch {
            if (copyFeedback) copyFeedback.textContent = 'Impossibile copiare automaticamente, copia manualmente.';
          }
        });
      }

      const scrollTopBtn = document.getElementById('scroll-top-btn');
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)');
      if (scrollTopBtn) {
        const toggleScrollTopVisibility = () => {
          const shouldShow = window.scrollY > 450;
          scrollTopBtn.classList.toggle('is-visible', shouldShow);
        };
        window.addEventListener('scroll', toggleScrollTopVisibility, { passive: true });
        toggleScrollTopVisibility();
        scrollTopBtn.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: prefersReducedMotion.matches ? 'auto' : 'smooth' });
        });
      }

      const footerText = document.querySelector('.main-footer p');
      if (footerText) {
        footerText.innerHTML = footerText.innerHTML.replace(/\d{4}/, new Date().getFullYear().toString());
      }
    };

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initEnhancements);
    } else {
      initEnhancements();
    }
  </script>


        <script>
  function openPoetryWidget() {
    const header = document.querySelector('header, .site-header, #header');
    const widget = document.getElementById('poetry-widget-overlay');

    const headerHeight = header ? header.offsetHeight : 0;

    widget.style.top = headerHeight + 'px';
    widget.classList.remove('hidden');
  }

  function closePoetryWidget() {
    document.getElementById('poetry-widget-overlay')
      .classList.add('hidden');
  }
</script>
  
</body>
</html>
